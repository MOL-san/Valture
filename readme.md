# ハゲタカの餌食

これは、ある人とプログラミングで対決をしようと思い作ったものです。結局その計画は頓挫したので誰とも対決していません。

## ルール
このプログラムでは1対1を想定しているため、以下のルールもそれに基づきます。

まず、山札として-5\~-1,1\~10の15枚を用意します。プレイヤーにはそれぞれ、1\~15の15枚のカードが配られます。

1ターンごとに山札の一番上にあるカードを引き、場におきます。これは全員に公開されます。

プレイヤーはそれぞれ持ち札から一枚を出します。

もし、場に出ているカードの数字の合計がプラスならプラスなら出した札の大きいほう。合計がマイナスなら出した札の小さい方が場のカードを全て得ます。

もし、二人の出したカードが同じならそのターンはパスされ、今回山札から引いたカードは場に残され、引き継がれます。

これを繰り返し、得たカードの合計が大きいほうの勝ちです。


## 遊び方

まず、`colorama`というライブラリをpipなどで入手しておいてください。

入手したフォルダにある、valture.pyを実行すると変更を加えていない限り次のように表示されます。

```
=====================================
ゲーム開始
-------------------------------------
Turn 1
Table: 10
Table Point: 10

PERSON: 0
KUTSU-v1: 0

1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15
card:
```

ゲーム開始という合図の後ろは毎ターン表示されるものです。

Turn:        はそのターン番号

Table:       は今回引かれた札

Table Point: は現状場に出ているカードの合計


PERSON:      はプレイヤーの現状のポイント

KUTSU-v1:    は対戦相手の現状のポイント

を示します。PERSONとKUTSU-v1というのは、今遊んでいる人の名前なので、この後の方法に従ってプレイヤーを変更すると変わります。

1\~15の並びはあなたが今持っているカードの一覧です。

card:の後に、ここにある数値を入力し、エンターを押すことでカードを出すことができます。

これを繰り返し、決着をつけます。

ちなみに、何のカードも指定しないとエラーにより失格とされます。持っていないカードを出した場合、無効な操作によって失格にされます。

試合が終わると次のようなものが表示されます。

```
PERSON 無効な操作により失格
KUTSU-v1 勝利

MATCHES: 1-----------
|PERSON  : 0(0.0%)  |
|KUTSU-v1: 1(100.0%)|
|DRAW    : 0(0.0%)  |
---------------------

GRAPH
 PERSON  :  (0.0%)
 KUTSU-v1:  ####################################################################################################(100.0%)
 DRAW    :  (0.0%)
```

どちらがなぜ負けて、どちらが勝ったのか表示された後、統計情報が表示されます。
プログラムを書き換えて何試合も一気に行えるため、このようなものが表示されます。


## 遊び方の変更

何らかのテキストエディタで(vim,メモ帳,Sublime Textなど)valture.pyを開きます。
その下の方に
if __name__ == "__main__":
という記述があるはずです。

そのすぐ下に

```python
# プレイヤーの設定
p1_func = person
p2_func = kutsu1
```

と書かれています。p1_func,p2_funcはどちらもプレイヤーを指定するものです。
人間が遊ぶときはpersonを指定すると、人が入力して遊べます。
用意されているプレイヤーは次の通りです。

person          人間が遊ぶときよう

choice_min      常に最小のカードを出す

choice_max      常に最大のカードを出す

choice_random   ランダムなカードを出す

sakura1         場のカードがマイナスなら持ち札のうち小さい方からランダムで、プラスならその逆をする

sakura2         sakura1に加えて15は必ずとる

sakura3         sakura1に加えて、あるカードの時は必ず出すカードを決めています

kutsu1          数千試合の分析結果をもとにカードを返します。

さらに下には、

```python
MATCHES = 1
```

という記述があります。これは試合数を設定する部分です。

プログラム同士の対決をしたいときには、ここを大きくするとその分試合をして、統計をとることができます。

その下の

```python
SHOW_PROGRESS = 1
SHOW_GAME = 0
```

のうち、`SHOW_PROGRESS`はゲームの進捗をグラフで、`SHOW_GAME`は試合の様子を見るかを指定します。

真偽値で指定するため、`1`,`0`などでも平気です。


## ツール

フォルダ内には`kutsukawa.py`というファイルがあります。この中にはkutsu1などが入っています。

それを作るのに使ったのが、`analysis`という関数です。これは、p1,p2(player1,player2)と試合数(matches)を指定すると

その分の試合を行い、結果を出してくれます。

`kutsukawa.py`を実行するとanalysisを動かし、それをグラフで出力します。

あるカードを取った時の勝敗率を出力します。是非動かしてみてください。


## プレイヤーを作る

上に書いたプレイヤーに加え、そう望むなら新たにプレイヤーを作ることができます。

プレイヤーは関数の形で、雛形は次の通りです。

```python
def player(table=[], player={}, player2={}, name=""):
    if name:
        return "PLAYER"

    return player["card"][0]
```

引数についてまず説明します。

tableには、今場に出ているカードの一覧、player,player2にはそれぞれ、自分と相手の情報が入った辞書が入ります。

nameは普段は何も指定されないため、必ず`=""`とします。

上のプログラムを見れば分かる通り、nameが空ではない時名前を文字列として返すようにします。

playerとplayer2という辞書には、`name`,`point`,`card`というキーがあります。

nameはそのプレイヤーの名前、pointはそのプレイヤーの得点、cardはそのプレイヤーが持っているカードのリストとなっています。

プレイヤーは関数の形で作られるため、何らかの情報を保持したくても変数の形では消えてしまいます。

例えば、globals()関数を使ってグローバル変数として保持する方法もありますが、力技感もあるうえ、同じプレイヤーを同時に動かせません。

そのため、情報の保持はこのplayerという辞書を使います。ちなみに、相手の辞書を書き換えると強制敗北です。

続いて、カードの出し方です。カードは`player["card"]`に含まれるものから返します。

出したカードをわざわざ`player["card"]`から削除しなくとも、次のターンでは出したカードは削除されています。

プレイヤーの関数がエラーを起こしたり、持ち札にないカードを出したりすると敗北となるので注意が必要です。

### ランダムプレイヤー

では、以上のことを踏まえてランダムなカードを出すプレイヤーを制作しましょう。

まず、valtureフォルダ内に`player.py`というファイルを作り、テキストエディタで開きます。

続いて、下のように雛形を書き込みます。

```python
def player(table=[], player={}, player2={}, name=""):
    if name:
        return "PLAYER"

    return player["card"][0]
```

これをもとにプレイヤーを作りましょう。

まず、関数名を`random_player`とします。

```python
def random_player(table=[], player={}, player2={}, name=""):
    if name:
        return "PLAYER"

    return player["card"][0]
```

さらに、プレイヤーの名前を`ランダムプレイヤー`としましょう

```python
def random_player(table=[], player={}, player2={}, name=""):
    if name:
        return "ランダムプレイヤー"

    return player["card"][0]
```

後は、ランダムなカードを返す部分を作るのみです。ランダムということは、標準ライブラリの`random`が必要です。インポートしましょう。

```python
import random

def random_player(table=[], player={}, player2={}, name=""):
    if name:
        return "ランダムプレイヤー"

    return player["card"][0]
```

そして、ランダムなカードを返すようにします。カードは`player["card"]`から選びます。これはリストなので、`random.choice`が使えます。

```python
import random

def random_player(table=[], player={}, player2={}, name=""):
    if name:
        return "ランダムプレイヤー"

    return random.choice(player["card"])
```

これで完成です。

続いてこのプレイヤーと遊べるようにしましょう。

`valture.py`を開き、一番上の

```python
# ハゲタカのえじき
import random
import copy
import sys
import os
import io

from colorama import Fore, Back

from attached_players import *
from kutsukawa import kutsu1
```

の後ろに、`from player import random_player`と追記しましょう。

これで作ったプレイヤーを使えるようになったので、`遊び方の変更`の項目にしたがって`valture.py`の所定の部分を

```python
# プレイヤーの設定
p1_func = person
p2_func = random_player
```

と書き換えます。

以上の操作が完了したら、`valture.py`を実行することで作ったプレイヤーと遊びます。

さて、ここではランダムプレイヤーを作りましたがもちろん、何でも好きなプレイヤーをつくることができます。

ファイル名は`player.py`である必要はなく、必要なところさえ書き換えれば好きに動かせます。

是非プレイヤーを作ってみてください。

ついでに、用意されている全ての(人以外)プレイヤー総当たりで勝率、引き分け率を求め、表にして添付する予定です。

先手、後手というものがないため、表にすると同じ試合が2回分書かれることになりますが、あえて残そうと思います。

やってみると、sakuraシリーズの強さとkutsu1の強さが分かりますが、ある程度相性というものもあります。

基本的にsakuraシリーズはバージョンが上がるにつれ強くなりますが、sakura3は相手によって差が出てきます。

kutsu1は勝率が全て70%を超え、負けなしの強さです。その理由として、choiceシリーズもsakuraシリーズも根底にはランダムがあるからです。

kutsu1はランダムな試合の結果をもとに構成されている(といっても中身は一行)ため、それらの強いのです。